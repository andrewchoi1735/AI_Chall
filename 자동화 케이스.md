
# 📌 Albamon E2E 자동화 테스트 케이스

## 시나리오1: 로그인 성공 검증

### 🎯 테스트 목적
- 올바른 사용자 계정으로 로그인 시 정상적으로 **마이페이지**로 이동되는지 확인한다.  
- 로그인 후 주요 UI 요소가 정상 표시되는지 검증한다.  

### 📝 테스트 절차
1. 로그인 페이지 접속  
2. 올바른 아이디/비밀번호 입력  
3. 로그인 버튼 클릭  
4. 마이페이지 접근 성공 여부 확인  

### ✅ 기대 결과
- 로그인 후 **마이페이지 URL**로 리다이렉트된다.  
- 마이페이지의 핵심 텍스트(`회원정보`, `이력서`, `지원현황`)가 노출된다.  

### ⚠️ 예외/추가 검증
- 네트워크 장애 시 에러 메시지 노출 여부  
- 이미 로그인된 상태에서 재접속 시 정상 동작 여부  

### 📂 참고 코드
```python
def test_login_success(playwright, browser, device_profile):
    context = browser.new_context(**device_profile)
    page = context.new_page()
    login = LoginPage(page)
    login.goto()
    login.fill_username(ALBAMON_ID)
    login.fill_password(ALBAMON_PW)
    login.submit()
    page.wait_for_load_state("domcontentloaded")
    expect_on_mypage(page)
    context.close()
```

---

## 시나리오2: 로그인 실패 검증

### 🎯 테스트 목적
- 잘못된 사용자 계정으로 로그인 시 **오류 메시지가 노출되는지** 확인한다.  
- 보안상 적절한 안내 메시지가 표시되는지 검증한다.  

### 📝 테스트 절차
1. 로그인 페이지 접속  
2. 잘못된 아이디/비밀번호 입력  
3. 로그인 버튼 클릭  
4. 오류 메시지 확인  

### ✅ 기대 결과
- 로그인 실패 시 로그인 페이지에 머무른다.  
- `"아이디 또는 비밀번호를 확인하세요."` 메시지가 노출된다.  

### ⚠️ 예외/추가 검증
- 연속 5회 이상 실패 시 **계정 잠금 여부** 확인  
- 캡차 인증(추가 보안 단계) 발생 여부  
- SQL 인젝션/스크립트 입력 시 보안 방어 여부  

### 📂 참고 코드
```python
def test_login_failure(playwright, browser, device_profile):
    context = browser.new_context(**device_profile)
    page = context.new_page()
    login = LoginPage(page)
    login.goto()
    login.fill_username("wrong_user")
    login.fill_password("wrong_pass")
    login.submit()
    page.wait_for_load_state("domcontentloaded")
    expect_login_error(page)
    context.close()
```

---

## 시나리오3: 로그인 상태 유지 (`Keep Signed In`)

### 🎯 테스트 목적
- 로그인 시 `로그인 상태 유지` 옵션 활성화 시, **브라우저 재시작 후에도 세션이 유지되는지** 검증한다.  
- `토큰 주입 방식`으로 자동 로그인 기능을 확인한다.  

### 📝 테스트 절차
1. 최초 로그인 (`로그인 상태 유지` 체크)  
2. 세션/토큰을 추출 후 `albamon_state.json` 저장  
3. 새 브라우저 세션 생성 후 토큰 주입  
4. 로그인 과정 없이 **마이페이지** 접근 시도  
5. 세션 유지 여부 확인  

### ✅ 기대 결과
- 마이페이지에 정상 진입 가능  
- 세션 만료 시 로그인 페이지로 리다이렉트  

### ⚠️ 예외/추가 검증
- 토큰 만료 → 재로그인 요구 여부  
- 토큰 변조 → `401 Unauthorized` 발생 여부  
- `로그인 상태 유지 OFF` 시 동작 불가 확인  
- 멀티 디바이스 동시 로그인 시 동기화 여부  

### 📂 참고 코드
```python
def test_keep_signed_in_with_token_injection(playwright, browser, device_profile, tmp_path):
    # 1) 최초 로그인
    context1 = browser.new_context(**device_profile)
    page1 = context1.new_page()
    login = LoginPage(page1)
    login.goto()
    login.fill_username(ALBAMON_ID)
    login.fill_password(ALBAMON_PW)
    login.toggle_keep_signed_in(True)
    login.submit()
    page1.wait_for_load_state("domcontentloaded")
    expect_on_mypage(page1)

    # 2) 토큰 추출 및 저장
    local_storage = context1.storage_state()
    state_file = tmp_path / "albamon_state.json"
    with open(state_file, "w", encoding="utf-8") as f:
        f.write(json.dumps(local_storage))
    context1.close()

    # 3) 토큰 주입 후 새 세션 열기
    context2 = browser.new_context(storage_state=str(state_file), **device_profile)
    page2 = context2.new_page()
    page2.goto(f"{BASE_URL}/mypage", wait_until="domcontentloaded")
    expect_on_mypage(page2)
```
